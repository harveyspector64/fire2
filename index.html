<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest Fire Simulator</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <canvas id="forestCanvas" width="600" height="600"></canvas>
    <script>
        const canvas = document.getElementById('forestCanvas');
        const ctx = canvas.getContext('2d');

        // Size of each tile in the grid
        const tileSize = 10;
        // Calculate number of rows and columns based on canvas size
        const rows = canvas.height / tileSize;
        const cols = canvas.width / tileSize;
        const forest = [];
        
        // Directions for fire spread (N, S, E, W, NE, NW, SE, SW)
        const directions = [
            [-1, 0], [1, 0], [0, -1], [0, 1],
            [-1, -1], [-1, 1], [1, -1], [1, 1]
        ];

        // Function to generate the forest grid with random trees
        function generateForest() {
            for (let y = 0; y < rows; y++) {
                forest[y] = [];
                for (let x = 0; x < cols; x++) {
                    // 70% chance of a cell being a tree, 30% chance of being empty
                    forest[y][x] = Math.random() < 0.7 ? 'tree' : 'empty';
                }
            }
        }

        // Function to draw the forest grid on the canvas
        function drawForest() {
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    // Set color based on the state of the cell
                    if (forest[y][x] === 'tree') {
                        ctx.fillStyle = 'green';
                    } else if (forest[y][x] === 'burning') {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'lightgrey';
                    }
                    // Draw the cell as a filled rectangle
                    ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
                }
            }
        }

        // Function to spread the fire in the forest
        function spreadFire() {
            // Create a copy of the forest to track changes without affecting the original
            const newForest = forest.map(row => [...row]);
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    // If the cell is burning, spread fire to adjacent cells
                    if (forest[y][x] === 'burning') {
                        // After burning, the cell becomes empty
                        newForest[y][x] = 'empty';
                        // Check all 8 possible directions
                        directions.forEach(([dy, dx]) => {
                            const newY = y + dy;
                            const newX = x + dx;
                            // If the adjacent cell is within bounds and is a tree, set it on fire
                            if (newY >= 0 && newY < rows && newX >= 0 && newX < cols && forest[newY][newX] === 'tree') {
                                newForest[newY][newX] = 'burning';
                            }
                        });
                    }
                }
            }
            // Update the forest with the new state
            for (let y = 0; y < rows; y++) {
                forest[y] = [...newForest[y]];
            }
            // Redraw the forest
            drawForest();
        }

        // Function to start a fire at a specific location
        function startFire(x, y) {
            // Convert pixel coordinates to grid coordinates
            const gridX = Math.floor(x / tileSize);
            const gridY = Math.floor(y / tileSize);
            // If the selected cell is a tree, set it on fire
            if (forest[gridY][gridX] === 'tree') {
                forest[gridY][gridX] = 'burning';
                drawForest();
            }
        }

        // Event listener for mouse clicks to start a fire
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            // Calculate the mouse position relative to the canvas
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            startFire(x, y);
        });

        // Event listener for touch events to start a fire (for mobile devices)
        canvas.addEventListener('touchstart', (e) => {
            const rect = canvas.getBoundingClientRect();
            // Calculate the touch position relative to the canvas
            const x = e.touches[0].clientX - rect.left;
            const y = e.touches[0].clientY - rect.top;
            startFire(x, y);
            e.stopPropagation();
        });

        // Initialize the forest and draw it for the first time
        generateForest();
        drawForest();
        // Set an interval to spread fire every 500 milliseconds
        function startSpreadFire() {
            spreadFire();
            requestAnimationFrame(startSpreadFire);
        }
        requestAnimationFrame(startSpreadFire);
    </script>
</body>
</html>
